$(function(){function u(){$(".modal-dialog").trigger($.Event("elementResize"))}function f(n){setTimeout(function(){$(n).focus()},400)}function o(){var t=supportCenter.viewModel.question.editModel(),i=t?t.attachments().map(function(n){return n.fileName()}):null;return $(".modal-body form[id^='edit-post-form']",n).serialize()+JSON.stringify(i)}var t=$("#content"),i=$("html"),r=3,e,n;(function(){function t(){var t=$(n).is(":visible")&&o()!==e;return t||supportCenter.viewModel.hasUnsavedPost()}supportCenter.model=JSON.parse(supportCenter.model);supportCenter.constants.postTypeMap=JSON.parse(supportCenter.constants.postTypeMap);$(document).keydown(function(i){var r=supportCenter.viewModel.question.editModel()&&i.keyCode===keyCodes.esc;return r?(t()?confirm(supportCenter.text.editTicketBeforeUnloadWarning)&&(supportCenter.viewModel.question.editModel().cancelEdit(),$(n).modal("hide")):(supportCenter.viewModel.question.editModel().cancelEdit(),$(n).modal("hide")),!0):!0});window.onbeforeunload=function(n){if(t()){var i=supportCenter.text.editTicketBeforeUnloadWarning;return typeof n=="undefined"&&(n=window.event),n&&(n.returnValue=i),i}}})(supportCenter.common),function(n,s,h,c,l,a,v,y,p){function k(n){supportCenter.viewModel.properties.modified(moment.utc(n).toISOString())}function rt(n){typeof n=="string"&&(n=n.toLowerCase());switch(n){case"true":return!0;case"false":return!1;default:return n}}function tt(n){var t={};return t.isVisible=!n.hasExternalDataSource||n.availableValues.length>0,t.isEditable=!n.hasExternalDataSource||n.availableValues.length===2,t.selectedValue=ko.observable(n.selectedValue),t.optionDisplayValue=function(){if(!n.hasExternalDataSource)return"";var i=n.availableValues.filter(function(n){return rt(n.value)===t.selectedValue()})[0];return i?i.displayName:""},t}var it=function(n,t,i,r,u,f,e){var o={};return o.id=n,o.parentOid=t,o.postType=i,o.description=ko.observable(r),o.isNewPost=e,o.isOwnTicket=function(){return supportCenter.client&&supportCenter.viewModel.owner&&supportCenter.viewModel.owner.id&&supportCenter.client.Id===supportCenter.viewModel.owner.id()},o.isPrivate=f&&ko.unwrap(f.isPrivate)?ko.observable(f.isPrivate()):ko.observable(!1),o.approvedBySupportAgent=f&&ko.unwrap(f.approvedBySupportAgent)?ko.observable(f.approvedBySupportAgent()):ko.observable(!1),o.attachments=ko.observableArray(),o.existedAttachments=ko.observableArray(ko.toJS(u)),o.attachmentsState=ko.computed(function(){var n=[];return $.each(u,function(t,i){var r={key:i.itemOid(),value:o.existedAttachments().some(function(n){return i.itemOid()===n.itemOid})};n.push(r)}),n}),o},nt=function(n,t){var i={};return i.id=ko.observable(),i.parentOid=n,i.postType=ko.observable(t),i.description=ko.observable(""),i.attachments=ko.observableArray(),i},b=function(n){n.getUrl=function(){return l.getAttachment+"/"+n.itemOid()}},w=function(n){function u(n,r){var f=i.scrollTop(),e=$(window).height()/2,u=t,o;if(n){if(r.length===0)return;t=f;u=r.offset().top-e;r.find(".btn-danger").focus()}o=100;Math.abs(f-u)>e-o&&i.animate({scrollTop:u},"600")}n.inRemoveMode=ko.observable(!1);n.showPreviousComments=ko.observable(!1);var t=0;n.toggleRemove=function(t,i){n.inRemoveMode(!n.inRemoveMode());u(n.inRemoveMode(),$(i.target).parents(".comment").find(".removing-mode .content-block.confirm"))};n.removing=ko.observable(!1);n.errors=ko.observableArray();n.orderedComments=function(t){var i=n.comments().length;return $.map(n.comments(),function(n,u){var f=i-u;if(t==="previous"&&f>r||t==="latest"&&f<=r)return n})};n.cancelRemoving=function(){n.removing(!1);n.errors.removeAll()};n.remove=function(t,i){n.removing(!0);c.ajaxSubmitForm($("#remove-post-form-"+n.id()),function(n){n.Success&&(t.remove(i),k(n.ServerTime));supportCenter.viewModel.loadTriggerChanges()},function(t){n.errors.removeAll();n.removing(!1);n.inRemoveMode(!1);t.status===401?n.errors.push({message:supportCenter.errorsText.unauthorized}):n.errors.push({message:t.ErrorMessage?t.ErrorMessage:supportCenter.errorsText.defaultServerError})})};n.togglePreviousComments=function(){n.showPreviousComments(!n.showPreviousComments())};$.each(n.attachments(),function(n,t){b(t)});g(n,n.postType(),function(t){if(t&&t.Success){var i=ko.mapping.fromJS(JSON.parse(t.Data));n.description(i.description());n.attachments($.map(i.attachments(),function(n){return b(n),n}));n.modifiedOn(i.modifiedOn());n.properties.isPrivate!=undefined&&n.properties.isPrivate(i.properties.isPrivate());n.properties.approvedBySupportAgent!=undefined&&n.properties.approvedBySupportAgent(i.properties.approvedBySupportAgent());n.editMode(!1);setTimeout(function(){n.editModel(null)},100);k(t.ServerTime)}});n.makeTicketPublicBanner=ko.observable({visible:ko.observable(!1),licenseAgreement:ko.observable(!1),changedVisibilityTicketMessageVisible:ko.observable(!1)});n.closeMakeTicketPublicBanner=function(){n.makeTicketPublicBanner().visible(!1);n.makeTicketPublicBanner().licenseAgreement(!1);n.makeTicketPublicBanner().changedVisibilityTicketMessageVisible(!1)};n.showLicenseAgreementBanner=function(){n.makeTicketPublicBanner().licenseAgreement(!0)};n.acceptedLicenseAgreement=function(){n.closeMakeTicketPublicBanner();n.makeTicketPublicBanner().changedVisibilityTicketMessageVisible(!0)}},g=function(t,i,r){function l(){$(".edit-question-modal").modal("show");setTimeout(function(){$(".ticket-subject input").focus();e=o();supportCenter.viewModel.question.editModel().prepareSubmitPostForm()},0)}t.editMode=ko.observable(!1);t.postVisible=ko.observable(!1);t.slideCallback=function(n){t.postVisible(!t.postVisible());var i=$(n).find(".post-editor");i.is(":visible")&&setTimeout(function(){h.scrollToContentElement(i);var n=typeof simplemdeEditors!="undefined"?simplemdeEditors[i.find("textarea.wmd-input").attr("id")]:null;n&&n.codemirror&&n.codemirror.focus()},150)};t.switchMode=function(){t.editMode(!t.editMode());t.editMode()&&t.editModel().prepareSubmitPostForm()};t.editMode.subscribe(function(){t.editClick()});t.editModel=ko.observable(null);t.editClick=function(){var e=it(t.id(),t.parentOid?t.parentOid:null,i,t.description(),t.attachments(),t.properties,t.isNewPost),o,v;e.attachments.push(h.viewModels.attachViewModel());e.permissions=t.permissions;e.submitToken=ko.observable(h.helpers.generateGuid());e.cancelEdit=function(){t.editMode(!1);setTimeout(function(){t.editModel(null)},100);e.postType===0&&f("#edit-question-btn")};e.posting=ko.observable(!1);e.isValidated=ko.observable(!1);e.validateParse=ko.observable(!1);e.postErrors=ko.observableArray();e.validateErrors=ko.observableArray();e.changeTextareaEvent=function(n,t){n.validateParse()&&(e.attachments.valueHasMutated(),e.$form.find("input[name=AttachmentsCount]").valid(),$(t.target).valid())};e.clearErrors=function(){e.posting(!1);e.postErrors.removeAll()};e.hasElementError=function(n){return e.getElementErrors(n).length!=0};e.getElementErrors=function(n){return e.validateErrors().filter(function(t){return t.element===n})};e.isDisableSubmit=function(){return e.getPostAllErrors().length&&!(e.hasElementError("AttachmentsCount")&&e.getPostAllErrors().length==1)||e.attachments().some(function(n){return n.upload()!==1.1})||e.isLicenseAccepted&&!e.isLicenseAccepted()||e.posting()};e.revalidForm=function(){e.validateParse()&&(a.parseDataAnnotationToRules(e.$form),e.$form.valid());u()};e.getPostAllErrors=function(){var n=[];return e.getElementErrors("description").forEach(function(t){n.push(t)}),n};e.submitted=!1;e.prepareSubmitPostForm=function(){e.$form=$("#"+supportCenter.viewModel.generateFormId(t.id(),t.parentOid,t.editModel().postType));e.formAttachmentsSelector=e.$form.selector+" .attachment:visible .form-attachment";e.$form.validate({ignore:"",highlight:function(n){a.highlight(n.name,this.errorMap[n.name],e.validateErrors)},unhighlight:function(n){var t=e.getElementErrors(n.name)[0];t&&e.validateErrors.remove(t)},submitHandler:function(n){e.isValidated(!0);e.posting(!0);h.helpers.cleanEmptyAttaches(e.attachments);c.ajaxSubmitForm($(n),function(n){if(e.posting(!1),n&&n.Success)r(n);else if(e.submitToken(h.helpers.generateGuid()),n.Errors.length){for(errorKey in n.Errors)e.postErrors.push({element:n.Errors[errorKey].ElementName,message:n.Errors[errorKey].ErrorMessage});e.isValidated(!1)}else e.postErrors.push({message:""});supportCenter.viewModel.loadTriggerChanges()},function(n){e.postErrors.removeAll();e.submitToken(h.helpers.generateGuid());e.posting(!1);n.status===401?e.postErrors.push({message:supportCenter.errorsText.unauthorized}):supportCenter.viewModel.postErrors.push({message:n.ErrorMessage?n.ErrorMessage:supportCenter.errorsText.defaultServerError})})},errorPlacement:function(){return!1}});a.parseDataAnnotationToRules(e.$form);e.validateParse(!0)};e.submitChanges=function(){(!e.isLicenseAccepted||e.isLicenseAccepted())&&(e.attachments.valueHasMutated(),e.submitted=!0,e.$form.submit())};o=s.postTypeMap[i];o==="TicketDescription"&&(e.ticketId=n.id,e.encodedSubject=ko.observable(h.encodeHtml(n.subject)),e.subject=ko.observable(n.subject),e.subject.subscribe(function(n){e.encodedSubject(h.encodeHtml(n))}),e.privateModel=tt(n.properties.private),e.urgentModel=tt(n.properties.urgent),e.isLicenseAccepted=function(){return e.isPublicTicketAgreementAccepted()||e.privateModel.selectedValue()!==!1},e.isPublicTicketAgreementAccepted=ko.observable(e.privateModel.selectedValue()===!1),e.setFocusOnPrivateField=function(){$("#edit-question-modal .privacy-switcher .selected-value").focus()});e.permissions={canSetPrivacyForPost:ko.observable(o==="Comment"&&!n.properties.private.selectedValue)};v="#"+supportCenter.viewModel.generateFormId(e.id,e.parentOid,e.postType);supportCenter.attachmentExtender.extendModel(e,v,v+" input[name=AttachmentsCount]",e.getElementErrors,u);t.editModel(e);o==="TicketDescription"&&l()}},d=function(n,t){var r=nt(n.id(),t),i=s.postTypeMap[t];g(r,t,function(t){if(t&&t.Success){k(t.ServerTime);var r=ko.mapping.fromJS(JSON.parse(t.Data));i==="Comment"&&(w(r),n.comments.push(r));i==="Answer"&&(w(r),d(r,2),r.comments=ko.observableArray(),supportCenter.viewModel.answers.push(r));n["new"+i].editMode(!1);setTimeout(function(){n["new"+i].editModel(null)},100)}});r.isNewPost=!0;n["new"+i]=r},ut=function(n){ko.unwrap(n)&&(n.encodedMessage=ko.observable(""),n.message=ko.observable(""),n.message.subscribe(function(t){n.encodedMessage(h.encodeHtml(t))}),n.isFeedbackMessageVisible=ko.observable(!1),n.isFeedbackWidgetVisible=ko.observable(!0),n.sendFeedback=function(t){var i=ko.unwrap(n.satisfaction)!=t;if(n.isFeedbackMessageVisible()){if(!i&&!n.message()){n.isFeedbackMessageVisible(!1);return}}else n.isFeedbackMessageVisible(i);n.satisfaction(t);c.ajaxSubmitForm($("#send-feedback-form"),function(t){t&&t.Success&&(n.message()&&n.isFeedbackMessageVisible(!1),n.message(""))});$(".feedback-editor").focus()},n.hideFeedbackWidget=function(){n.isFeedbackWidgetVisible(!1);n.message("")})};supportCenter.viewModel=function(){var t={create:function(t){function u(n){return r.answers().filter(function(t){return ko.unwrap(t.properties.approvedBySupportAgent)===n})}function e(n,t){var i=h.getUrlWithFilters(l.ticketList,[{filterName:n,selectedValues:[t]}]);window.open(i,"_blank")}var r=ko.mapping.fromJS(t.data);return r.postErrors=ko.observableArray(),r.cancelErorrs=function(){r.postErrors.removeAll()},r.getUserProfileUrl=function(n){return l.userDetails+"/"+n},r.avatarHelper=y,r.getTicketDetailsUrl=function(n,t){return l.details+"/"+n.toLowerCase()+"/"+v.getTicketSubject(t)},r.removeChild=function(n,t){return n.remove(t)},r.updateTracking=function(){var n=r.tracked();r.postErrors.removeAll();c.ajaxSubmitForm($("#update-tracking-form"),function(t){t.Data===n&&(r.postErrors.push({message:supportCenter.errorsText.defaultServerError}),r.tracked(!n))},function(n){n.status===401?r.postErrors.push({message:supportCenter.errorsText.unauthorized}):r.postErrors.push({message:n.ErrorMessage?n.ErrorMessage:supportCenter.errorsText.defaultServerError})});r.tracked(!n)},r.votePost=function(n){r.postErrors.removeAll();var t=s.postTypeMap[n.postType()];(t==="Answer"||t==="TicketDescription"&&r.entityType.allowRateDescription())&&c.ajaxSubmitForm($("#thumbs-up-form-"+n.id()),function(t){t&&t.Success&&(t.Data?n.votes.push(p.Id):n.votes.splice(n.votes.indexOf(p.Id),1),r.setMakeTicketPublicVisible(n,p.Id))},function(n){n.status===401?r.postErrors.push({message:supportCenter.errorsText.unauthorized}):r.postErrors.push({message:n.ErrorMessage?n.ErrorMessage:supportCenter.errorsText.defaultServerError})})},r.makeTicketPublic=function(t){t.acceptedLicenseAgreement();r.postErrors.removeAll();c.ajaxSubmitForm($("#make-ticket-public"),function(t){t&&t.Success&&(r.properties.private.selectedValue(!1),n.properties.private.selectedValue=!1)},function(n){n.status===401?r.postErrors.push({message:supportCenter.errorsText.unauthorized}):r.postErrors.push({message:n.ErrorMessage?n.ErrorMessage:supportCenter.errorsText.defaultServerError})})},r.isVotedByCurrentUser=function(n){return p&&n.votes.indexOf(p.Id)!==-1},r.setMakeTicketPublicVisible=function(n,t){if(!n.votes.length){var i=r.properties&&ko.unwrap(r.properties.private.selectedValue)!==!1,u=r.isVotedByCurrentUser(n)&&ko.unwrap(r.owner.id)===t&&i;n.makeTicketPublicBanner().visible(u)}},r.closeMakeTicketPublicBanner=function(){r.question.closeMakeTicketPublicBanner();r.answers().forEach(function(n){n.closeMakeTicketPublicBanner()})},r.hasUnsavedPost=function(){function n(n){return n.editMode()&&(n.editModel().description()||n.editModel().attachments().some(function(n){return n.fileName()})||n.editModel().isPrivate&&n.editModel().isPrivate())}function t(n){return n.editMode()&&(n.description()!==n.editModel().description()||n.editModel().attachments().some(function(n){return n.fileName()})||n.attachments().length!==n.editModel().existedAttachments().length||n.properties.isPrivate&&n.editModel().isPrivate&&n.properties.isPrivate()!==n.editModel().isPrivate())}return n(r.question.newAnswer)||n(r.question.newComment)||r.question.comments().some(function(n){return t(n)})||r.answers().some(function(t){return n(t.newComment)})||r.answers().some(function(n){return t(n)})||r.answers().some(function(n){return n.comments().some(function(n){return t(n)})})},r.generateFormId=function(n,t,i){return"edit-post-form-"+(n||t+"-"+i)},w(r.question),$.each(r.question.attachments(),function(n,t){b(t)}),$.each(r.question.comments(),function(n,t){w(t)}),$.each(r.answers(),function(n,t){w(t);$.each(t.attachments(),function(n,t){b(t)});$.each(t.comments(),function(n,t){w(t)});d(t,2);t.removeChild=function(n){t.comments.remove(n)}}),g(r.question,0,function(t){var i=ko.mapping.fromJS(JSON.parse(t.Data));n.properties.private.selectedValue=r.question.editModel().privateModel.selectedValue();n.properties.urgent.selectedValue=r.question.editModel().urgentModel.selectedValue();n.subject=r.question.editModel().subject();r.properties.private.selectedValue(n.properties.private.selectedValue);r.properties.urgent.selectedValue(n.properties.urgent.selectedValue);r.subject(n.subject);r.question.description(i.description());r.question.modifiedOn(i.modifiedOn());r.question.attachments($.map(i.attachments(),function(n){return b(n),n}));r.closeMakeTicketPublicBanner();$(".edit-question-modal").modal("hide");r.question.editModel(null);f("#edit-question-btn");k(t.ServerTime)}),d(r.question,1),d(r.question,2),r.approvedAnswers=ko.observableArray(u(!0)),r.otherAnswers=ko.observableArray(u(!1)),r.answers.subscribe(function(){r.approvedAnswers(u(!0));r.otherAnswers(u(!1))}),r.newAnswer=nt(r.question.id()),w(r.newAnswer),r.sidebarVisible=ko.observable(!1),r.sidebarToggled=ko.observable(!1),r.toggleSidebar=function(){r.sidebarToggled(!0);r.sidebarVisible()||i.scrollTop(0);r.sidebarVisible(!r.sidebarVisible())},r.loadTriggerChanges=function(){r.isActiveTrigger()!==!1&&c.getTriggerChanges({ticketId:r.id()},function(n){var t,i,r;n&&n.Success&&(t=JSON.parse(n.Data),supportCenter.viewModel.tracked(t.tracked),i=ko.mapping.fromJS(t.tags),supportCenter.viewModel.extendTags(i),supportCenter.viewModel.tags(i()),r=ko.mapping.fromJS(t.categories),supportCenter.viewModel.extendCategories(r),supportCenter.viewModel.categories(r()),supportCenter.viewModel.properties.private.selectedValue(t.properties.private.selectedValue),supportCenter.viewModel.properties.urgent.selectedValue(t.properties.urgent.selectedValue),supportCenter.model.properties.private.selectedValue=t.properties.private.selectedValue,supportCenter.model.properties.urgent.selectedValue=t.properties.urgent.selectedValue)})},r.getHtml=function(n,t){return h.makeHtml(n,t,window.location.host.split(".").slice(-2).join("."))},r.extendTags=function(n){function t(n){var t=n;t.filterTicketsByTag=function(){e("Tag",t.id())}}$.each(n(),function(n,i){t(i)})},r.extendTags(r.tags),r.extendCategories=function(n){$.each(n(),function(n,t){function i(n){var t=n;t.filterTicketsByCategory=function(){e("Category",t.id())}}i(t)})},r.extendCategories(r.categories),r.joinTicketFieldValues=function(n){if(n.fieldTemplate()===0)return"";var t=$.map(ko.toJS(n.selectedValues()),function(n){return n.displayName||n.value});return t.join(", ")},ut(r.feedback),r.relatedTickets=ko.observableArray(),r.openTicketFormClick=function(){supportCenter.newTicketWrapper.init()},r.isAddAnswerVisible=ko.computed(function(){return supportCenter.client&&supportCenter.client.IsEmployee||!r.answers().some(function(n){return supportCenter.client&&n.owner&&n.owner.id()===supportCenter.client.Id})}),r.isOwnTicket=ko.computed(function(){return supportCenter.client&&r.owner&&r.owner.id&&supportCenter.client.Id===r.owner.id()}),r}};return ko.mapping.fromJS(n,t)}();ko.applyBindings(supportCenter.viewModel,t[0]);$("#footer").addClass("footer-full-width");supportCenter.browserHistoryWrapper.init(null,supportCenter.newTicketWrapper.getHistoryStateActions());supportCenter.editorShortcuts.init()}(supportCenter.model,supportCenter.constants,supportCenter.common,supportCenter.dataService,supportCenter.urlConfiguration,supportCenter.validator,supportCenter.seoLinksHelper,supportCenter.avatarHelper,supportCenter.client);t.show();$.each($(".sidebar-group"),function(n,t){var i=$(t),r=i.children(".group-header"),u=i.children(".group-content");r.click(function(){u.slideToggle("fast");i.toggleClass("content-hidden")})});n="#edit-question-modal",function(n){function r(){$(window).width()>i||!n.sidebarVisible()?t.css("height","auto"):t.css("height",Math.max(e.height(),o.height())+f+"px")}function u(){if(t.css("height","auto"),$(window).width()>i)n.sidebarVisible(!0);else{if(n.sidebarToggled())return!1;n.sidebarVisible(!1)}}var i=1024,f=70,t=$("#main-content"),e=t.find("#primary-content"),o=t.find("#sidebar");n.sidebarVisible.subscribe(function(){r()});$(window).resize(function(){u();r()});u()}(supportCenter.viewModel),function(n){var t=$(".unread:first");t.length&&n.scrollToContentElement(t)}(supportCenter.common);setTimeout(function(){t.addClass("ready");$("#sidebar-switcher").addClass("with-transition");$("#sidebar").addClass("with-transition")},0)})