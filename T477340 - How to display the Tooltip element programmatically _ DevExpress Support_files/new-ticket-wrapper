var supportCenter=supportCenter||{},keyCodes={tab:9,enter:13,esc:27,up:38,down:40},fieldTemplates={checkbox:0,dropdown:1,multipleDropdown:3,calculated:7},previousValuesHelper=function(){function t(n,t){var i='[data-field-name="'+n.name()+'"]';switch(n.fieldTemplate()){case fieldTemplates.checkbox:n.selectedValue(t?t:!1);break;case fieldTemplates.dropdown:case fieldTemplates.multipleDropdown:$("select"+i).val(t).trigger("change");break;default:$(i).val(t).trigger("change")}}function i(n,i){var r,u;if(n){if(r=n.fieldTemplate()===fieldTemplates.multipleDropdown?i:i[0],!n.hasExternalDataSource()||!n.loading()){t(n,r);return}u=n.loading.subscribe(function(i){i||setTimeout(function(){t(n,r);u.dispose()},100)})}}function r(n,t){var r,i;switch(n.propertyName){case"Category":r=ko.toJS(t);r&&$("#select-category").val(r).trigger("change");break;case"Tag":i=ko.toJS(t);i&&i.length&&$('select[name="SelectedTags"]').val(i).trigger("change")}}function u(n){return n.sort(function(n,t){var i=n.dependentFieldNames?n.dependentFieldNames().length:0,r=t.dependentFieldNames?t.dependentFieldNames().length:0;return r<i?1:r>i?-1:r-i})}var n="SupportCenterPreviousValues";return{hasData:function(t){return supportCenter.common.localStorage.tryGetValue(n)&&t},saveData:function(t){var i={};t.ticketFields().filter(function(n){return n.fieldTemplate()!==fieldTemplates.calculated}).forEach(function(n){i[n.name()]=n.arrayOfSelectedValues()});t.systemFields().forEach(function(n){var t=n.selectedValue?n.selectedValue():n.selectedValues();i[n.propertyName]=t});supportCenter.common.localStorage.trySetValue(n,i)},restoreData:function(t){var f=supportCenter.common.localStorage.tryGetValue(n),o,e,s;if(f){o=[];for(e in f)s=t.getPropertyByName(e),s?r(s,f[e]):o.push(t.getTicketField(e));u(o).forEach(function(n){i(n,f[n.name()])})}}}}(),backspaceKeyCode;supportCenter.newTicketWrapper=function(n,t,i,r,u,f){function o(n){return $(s).find(n)}function v(n){var i,t;n.propertyName="Category";n.depth=0;i=ko.toJS(n.selectedValue)||"";n.isChanged=ko.computed(function(){return n.selectedValue()!==i});var f=supportCenter.categoryEditor(15,37,0);return n.select2Config=f.getSelect2Config(r.cultureInfo,u.categorySelectPlaceholder,function(){return n.itemsFlatList()}),t=f.categoryTreeToList("",n.availableItems,0,[]),t.unshift({text:"",value:""}),n.itemsFlatList=ko.observableArray(t),n.allSelectedValues=ko.computed(function(){var t=[];return $.each(supportCenter.newTicketModel.category.availableItems,function(i,r){r.some(function(t){return t.value===n.selectedValue()})&&(t=i.split("|").slice(1))}),t.concat(n.selectedValue())}),n}function y(n,t){var i={};return i.availableItems=n,i.select2Config={allowClear:!0,language:r.cultureInfo,width:"100%",minimumResultsForSearch:5,placeholder:u.tagSelectPlaceholder},i.propertyName="Tag",i.selectedValues=ko.observableArray(t),i.isChanged=ko.computed(function(){return i.selectedValues()&&i.selectedValues().length>0}),i}function h(){o(".modal-dialog").trigger($.Event("resize"))}function l(){setTimeout(function(){$(s).modal("show");o("#subject-editor").focus();h()},0)}function p(n){var r=ko.toJS(n.customizationGrid),i=n.ticketFields().filter(function(n){return n.isHiddenWhenEmpty()}),t=n.customizationGrid;t.sortedRows=ko.observableArray();n.refreshRows=function(){var u=0,f=[],e={};for($.each(r.rows,function(n,t){var r=[];$.each(t.columns,function(n,t){var u=i.filter(function(n){return n.name()===t.columnName})[0];(!u||u.options().some(function(n){return ko.toJS(n.value)}))&&r.push(t)});r.length>0&&f.push({columns:r})}),$.each(t.sortedRows(),function(n,t){$.each(t.columns(),function(n,t){e[t.columnName()]=t})}),f.forEach(function(i,r){var o=ko.observableArray(),f=t.sortedRows()[r];i.columns.forEach(function(t){var i=e[t.columnName];i||(i=ko.mapping.fromJS(t));n.getTicketField(t.columnName)&&(typeof i.fieldIndex=="function"?i.fieldIndex(u):i.fieldIndex=ko.observable(u),u+=1);o.push(i)});f?f.columns(o()):(f={columns:o},t.sortedRows.push(f))});t.sortedRows().length!==f.length;)t.sortedRows.pop();h()};t.getFieldIndex=function(n){var i=null;return t.sortedRows().some(function(t){var r=t.columns().filter(function(t){return t.columnName()===n})[0];return r?(i=r.fieldIndex(),!0):!1}),i};i.forEach(function(t){var i=t.options().length;t.options.subscribe(function(t){i!==t.length&&n.refreshRows();i=t.length})});n.refreshRows()}function w(r){var c=ko.mapping.fromJS(r.data),w,b,a;return c.isFormVisible=ko.observable(!0),c.systemFields=ko.observableArray(),c.postToken=ko.observable(n.helpers.generateGuid()),c.isSubjectFocused=ko.observable(!1),c.showRelatedList=ko.observable(!1),c.relatedTickets=ko.observableArray(),c.isPropertiesLoaded=ko.observable(!1),c.toggleTicketFormClick=function(){c.isFormVisible(!c.isFormVisible())},c.isFormVisible.subscribe(function(n){if(n){l();return}$(s).modal("hide")}),c.relatedTickets.subscribe(function(n){c.showRelatedList(c.isSubjectFocused()&&n.length>0)}),c.encodedSubject=ko.observable(""),c.filterableTicketFields=c.ticketFields().filter(function(n){return c.fieldsForRelatedTickets.indexOf(n.name())!==-1}),c.filterableTicketFieldValues=ko.computed(function(){return c.isPropertiesLoaded()?$.map(c.filterableTicketFields,function(n){return $.map(n.arrayOfSelectedValues(),function(t){return{name:n.name(),value:t}})}):[]}),c.categoryValues=ko.computed(function(){return ko.unwrap(c.category)&&ko.unwrap(c.category.selectedValue)?[{name:"category",value:c.category.selectedValue()}]:[]}),c.filterRelatedTickets=function(n,t,r){n&&n.length>3?i.loadRelatedTickets({term:n,ticketProperties:t.concat(r)},function(n){n=$.map(n.Data,function(n){return{subject:n.Subject,link:supportCenter.urlConfiguration.details+"/"+n.FriendlyId.toLowerCase()+"/"+f.getTicketSubject(n.Subject),friendlyId:n.FriendlyId}});n.length&&o("#related-tickets").width(o("#subject-editor").outerWidth()-2);c.relatedTickets(n)},null,$('input[name="__RequestVerificationToken"]',"#main-content").val()):c.relatedTickets([])},ko.computed(c.encodedSubject).extend({rateLimit:3e3}).subscribe(function(n){c.filterRelatedTickets(n,c.filterableTicketFieldValues(),c.categoryValues())}),ko.computed(function(){return{filterableTicketFieldValues:c.filterableTicketFieldValues(),categoryValues:c.categoryValues()}}).subscribe(function(n){c.filterRelatedTickets(c.encodedSubject(),n.filterableTicketFieldValues,n.categoryValues)}),c.subject.subscribe(function(t){c.encodedSubject(n.encodeHtml(t))}),c.changeTextareaEvent=function(n,t){c.validateParse()&&$(t.target).valid()},c.changeItemsEvent=function(n,t){return c.validateParse()&&(t.target.id==="select-category"&&$(t.target.parentElement.getElementsByTagName("input")).valid(),c.attachments.valueHasMutated(),o("input[name=AttachmentsCount]").valid()),(t.keyCode===keyCodes.esc||t.keyCode===keyCodes.enter||t.keyCode===keyCodes.tab)&&setTimeout(function(){return c.showRelatedList(!1),t.keyCode!==keyCodes.esc&&t.target.id==="subject-editor"?(simplemdeEditors[o("textarea")[0].id].codemirror.focus(),!1):void 0},100),t.keyCode===keyCodes.down&&$(t.target).next("ul").children(":first").children(".ticket-subject").focus(),!0},c.changeRelatedTicketFocus=function(n,t){var i=document.activeElement;switch(t.keyCode){case keyCodes.enter:break;case keyCodes.up:$(i).parent().prev(".ticket").find(".ticket-subject").focus();break;case keyCodes.down:$(i).parent().next(".ticket").find(".ticket-subject").focus();break;case keyCodes.tab:case keyCodes.esc:c.showRelatedList(!1);o("#subject-editor").focus();break;default:return}return!0},c.hasElementError=function(n){return c.getElementErrors(n).length!==0},c.getElementErrors=function(n){return c.validateErrors().filter(function(t){return t.element===n})},c.validateParse=ko.observable(!1),c.description=ko.observable(),w=0,c.description.subscribe(function(){var n=parseInt($(e).css("height"));n!==w&&(w=n,h())}),c.postErrors=ko.observableArray(),c.validateErrors=ko.observableArray(),c.isValidated=ko.observable(!1),c.posting=ko.observable(!1),c.allowTryAgainAction=ko.observable(!0),c.prepareNewTicketForm=function(){var r=$(e);r.validate({onfocusout:!1,ignore:"",highlight:function(n){var r=n.getAttribute("data-field-name"),i;r&&(i=c.getTicketField(r),i&&i.validation&&i.validation.validationError(this.errorMap[n.name]));t.highlight(n.name,this.errorMap[n.name],c.validateErrors)},unhighlight:function(n){var r=n.getAttribute("data-field-name"),t,i;r&&(t=c.getTicketField(r),t&&t.validation&&t.validation.validationError(""));i=c.getElementErrors(n.name)[0];i&&c.validateErrors.remove(i)},submitHandler:function(t){var r=c.postErrors().length>0;c.postErrors.removeAll();c.isValidated(!0);c.posting(!0);n.helpers.cleanEmptyAttaches(c.attachments);i.ajaxSubmitForm($(t),function(t){if(t&&t.Success)previousValuesHelper.saveData(c),window.location=t.Redirect;else if(c.postToken(n.helpers.generateGuid()),c.posting(!1),t.Errors.length){for(errorKey in t.Errors)c.postErrors.push({element:t.Errors[errorKey].ElementName,message:t.Errors[errorKey].ErrorMessage});c.isValidated(!1)}else c.allowTryAgainAction(!r),c.postErrors.push({message:""})},function(t){c.postToken(n.helpers.generateGuid());c.posting(!1);t.status===401?c.postErrors.push({message:supportCenter.errorsText.unauthorized}):(c.allowTryAgainAction(!r),c.postErrors.push({message:""}))})},errorPlacement:function(){return!1}}).resetForm();t.parseDataAnnotationToRules(r)},c.submitChanges=function(){c.isLicenseAccepted()&&(c.validateParse(!0),c.attachments.valueHasMutated(),o("input[name=AttachmentsCount]").valid(),$(e).submit())},c.isDisabledSubmit=ko.computed(function(){return c.validateErrors().length&&!(c.hasElementError("AttachmentsCount")&&c.validateErrors().length==1)||c.attachments().some(function(n){return n.upload()!==1.1})||c.posting()||!c.allowTryAgainAction()||!c.isLicenseAccepted()||!c.isPropertiesLoaded()}),c.customizationGrid.calculateAdaptiveCss=function(n){var t="site-col-"+n;return n>0&&n<4&&(t+=" site-col-4-sm-xs",t+=" site-col-4-xs"),n>=4&&n<8&&(t+=" site-col-8-sm-xs",t+=" site-col-8-xs"),t},b=e+" input[name=AttachmentsCount]",c.attachments.push(n.viewModels.attachViewModel()),supportCenter.attachmentExtender.extendModel(c,e,b,c.getElementErrors,h),c.cancelChanges=function(){var t,n;for(c.isFormVisible(!1),$(e).validate().resetForm(),$("select").trigger("change.select2"),ko.toJS(c.category)&&c.category.selectedValue(""),c.ticketFields().forEach(function(n){n.reset();n.validation&&n.validation.validationError("")}),simplemdeEditors[$(".editor-with-preview textarea[name=description]").attr("id")].value(""),c.subject(""),t=c.attachments,n=t().length-1;n>=0;n--)t()[n].visible()&&t.splice(n,1);c.isPublicTicketAgreementAccepted(!1);setTimeout(function(){$("#ask-question-btn").focus();c.validateErrors.removeAll()},200)},c.cancelChangesClick=function(){if(!c.allowTryAgainAction()){c.allowTryAgainAction(!0);c.cancelChanges();return}if(c.hasUnsavedNewTicketData==null||!c.hasUnsavedNewTicketData()){c.cancelChanges();return}var n=$(":focus");confirm(u.newTicketBeforeUnloadWarning)?c.cancelChanges():n.length&&setTimeout(function(){n.focus()},100)},c.clearErrors=function(){c.posting(!1);c.postErrors.removeAll()},c.getPropertyByName=function(n){return c.systemFields().filter(function(t){return ko.unwrap(t.propertyName)===n})[0]},c.hasPreviousValues=function(){return previousValuesHelper.hasData(ko.unwrap(c.isPropertiesLoaded))},c.restorePreviousValues=function(){previousValuesHelper.restoreData(c)},ko.unwrap(c.category)&&c.systemFields.push(v(c.category)),ko.unwrap(c.tag)&&c.systemFields.push(y(c.tag(),ko.toJS(c.selectedTags))),supportCenter.ticketFieldsWrapper.init(c,c.ticketFields),a=c.getTicketField(supportCenter.privateFieldName),a&&a.reset(),c.isPublicTicketAgreementAccepted=ko.observable(!1),c.getPrivacyFieldValue=function(){return a?a.selectedValue()===!0:null},c.isLicenseAccepted=function(){return c.isPublicTicketAgreementAccepted()||c.getPrivacyFieldValue()!==!1},c.setPrivacyValueFocus=function(){$(e+" .privacy-switcher .selected-value").focus()},$("body").click(function(n){var t=$(n.target);t.closest("#related-tickets").length!==0||t.is($("#subject-editor"))?t.is($("#subject-editor"))&&c.relatedTickets().length>0&&c.showRelatedList(!0):c.showRelatedList(!1)}),p(c),c}function b(n){function i(){return n.isPropertiesLoaded()&&(n.systemFields().some(function(n){return n.isChanged()})||n.ticketFields().some(function(n){return n.isChanged()}))?!0:n.subject()||n.description()||n.attachments().filter(function(n){return n.visible()}).length}function t(){var t=ko.unwrap(n.posting);return!t&&n.isFormVisible()&&i()}n.hasUnsavedNewTicketData=t;window.onbeforeunload=function(n){if(t()){var i=u.newTicketBeforeUnloadWarning;return typeof n=="undefined"&&(n=window.event),n&&(n.returnValue=i),i}}}function a(n,t){function a(){r=!0;$(s).modal("hide");c&&c.cancelRequest()}function v(){h();supportCenter.newTicketViewModel.isPropertiesLoaded(!0);$(e+" select").trigger("change.select2");$(e).find($("select[data-select2-id]")).one("select2:open",function(){var n=$(this).parent().find(".editor-label").text().trim().toLowerCase();$("input.select2-search__field").prop("placeholder",u.selectSearchPlaceholder.replace("{0}",n))})}var r,f;if(!supportCenter.isUserAuthenticated){window.location.href=supportCenter.urlConfiguration.create;return}if($(s).modal("show"),supportCenter.browserHistoryWrapper.setActionWithNewTicketModalState(),supportCenter.newTicketModel){supportCenter.newTicketViewModel.isFormVisible(!0);return}r=!1;f=".close-new-ticket-modal";$(f).click(a);$(document).keydown(function(n){var t,i;return n.keyCode!==keyCodes.esc?!0:(t=supportCenter.newTicketViewModel,$(f).length||!t)?(a(),!0):t.isPropertiesLoaded()?(i=t.isFormVisible()&&!o(".select2-container--open:visible").length&&!t.showRelatedList(),i&&t.cancelChangesClick(),!0):(t.cancelChanges(),!0)});c=i.getNewTicketModel(n?{ticketParameters:n}:{},{},function(n){var i,u;if(n)switch(n.status){case 401:window.location.href=supportCenter.urlConfiguration.login;return;case 200:if($(s).find(".modal-dialog").append(n.responseText),typeof supportCenter.newTicketModel=="string"&&(supportCenter.newTicketModel=JSON.parse(supportCenter.newTicketModel)),supportCenter.newTicketViewModel=function(){var n={create:w};return ko.mapping.fromJS(supportCenter.newTicketModel,n)}(),ko.applyBindings(supportCenter.newTicketViewModel,$(e)[0]),t&&t(supportCenter.newTicketViewModel),i=supportCenter.newTicketViewModel,i.prepareNewTicketForm(),$(".modal-dialog .new-ticket-content-template").remove(),$(".modal-dialog .modal-content").show(),r)return;if(h(),l(),b(i),!i.ticketFields().some(function(n){return n.loading?n.loading():!1})){v();return}u=ko.computed(function(){return i.ticketFields().some(function(n){return n.loading?n.loading():!1})}).subscribe(function(){v();u.dispose()})}},$('input[name="__RequestVerificationToken"]',"#main-content").val())}function k(){return{get:function(){var n=supportCenter.newTicketViewModel,t;if(!n){a();return}t=o(".post-description .editor>textarea").attr("id");n.isFormVisible()&&simplemdeEditors[t].codemirror.getOption("fullScreen")&&simplemdeEditors[t].toggleFullScreen();n.isFormVisible(!n.isFormVisible())}}}var e="#new-ticket-form",s="#new-question-modal",c;return{init:a,getHistoryStateActions:k}}(supportCenter.common,supportCenter.validator,supportCenter.dataService,supportCenter.resources,supportCenter.text,supportCenter.seoLinksHelper);supportCenter=supportCenter||{};backspaceKeyCode=8;supportCenter.browserHistoryWrapper=function(){function u(n,t,r){var u={stateEvent:n,data:t,documentTitle:document.title};window.history.pushState(u,u.documentTitle,r||window.location.href);i=n}function e(u,e){n=u;r=e;f();$(window).on("keypress",function(n){if(n.which===backspaceKeyCode){var t=n.target.tagName.toLowerCase();if(t==="input"||t==="textarea"||t==="select")return;n.preventDefault();n.stopPropagation()}});$(window).on("popstate",function(u){if(u.originalEvent.state&&u.originalEvent.state.stateEvent){var e=u.originalEvent.state.data||{},f=u.originalEvent.state.stateEvent,o=u.originalEvent.state.documentTitle;if(o&&(document.title=u.originalEvent.state.documentTitle),f===t.actionWithNewTicketModal||i===t.actionWithNewTicketModal&&r){r.get();i=f;return}f===t.updateTicketsList&&n&&(n.get(e),i=f)}})}function f(){n&&n.set&&n.set(t.updateTicketsList,u)}function o(){u(t.actionWithNewTicketModal)}var i,n,r,t={actionWithNewTicketModal:"actionWithNewTicketModal",updateTicketsList:"updateTicketsList"};return{init:e,setTicketListUpdateState:f,setActionWithNewTicketModalState:o}}();supportCenter=supportCenter||{};supportCenter.attachmentTypes=function(){function n(n){return/(?:\.([^.]+))?$/.exec(n)[1]}function t(t){var i=(n(ko.unwrap(t))||"").toLowerCase();switch(i){case"zip":case"rar":case"7z":return"archive-icon";case"png":case"gif":case"jpg":case"jpeg":case"bmp":case"ico":return"image-icon";case"tiff":case"tif":case"svg":return"browser-not-supported-image-icon";case"mp4":case"avi":case"vmw":case"webm":case"mov":case"flv":return"video-icon";case"pdf":return"pdf-icon";case"cs":case"vb":case"skin":case"sln":case"settings":case"csproj":case"vbproj":case"ascx":case"asax":case"cshtml":case"vbhtml":case"sql":case"ps1":return"visual-studio-icon";case"config":case"manifest":case"reg":case"ini":return"config-icon";case"swf":return"flash-player-icon";case"txt":case"md":return"txt-icon";case"css":case"js":case"resx":case"aspx":case"asp":case"xaml":case"xml":case"xafml":case"html":case"htm":case"xsd":case"xss":case"xsc":case"edmx":return"code-icon";case"docx":case"doc":case"rtf":case"odf":return"word-icon";case"xlsx":case"xls":case"csv":return"excel-icon";case"pptx":case"ppt":return"power-point-icon";default:return"another-icon"}}return{getCSS:t}}()