var supportCenter=supportCenter||{};supportCenter.ticketFieldsWrapper=function(n,t,i,r){function f(n){return u.ticketFields().filter(function(t){return t.name()===n})[0]}function o(n,t){var i=n.split(" ");return t&&(i=i.concat(t.split(" "))),i=i.filter(function(n,t){return i.indexOf(n)===t}),i.join(" ")}function c(n,t){n.length&&setTimeout(function(){n.data("select2").dataAdapter.updateOptions(t)},0)}function l(n){if(!n||!n.length)return!1;try{return JSON.parse(n)}catch(t){return!1}}function s(n,t){var i=n||[],r=[];return($.each(i,function(n,u){var e=l(u.group),f;e&&(u.group=e.hasParent?e.group:null,u.caption=e.caption,r.indexOf(u.caption)===-1&&r.push(u.caption));u.keywords=u.displayName;u.id=u.value;u.text=u.displayName;u.selected=t.indexOf(u.value)!==-1;f=i.filter(function(n){return n.displayName===u.group})[0];f&&(u.css=u.displayName===u.group?"root":"child",u.root=u.displayName===u.group?"":f.group,u.keywords=o(u.displayName,f.displayName),f.keywords=f.keywords||f.displayName,f.keywords=o(f.keywords,u.displayName))}),r.length)?$.map(r,function(n,t){var r=i.filter(function(t){return t.caption===n});if(r.length)return{id:t,text:n,children:r}}):i}function a(n,t,i){var r=t||[],f,u,e;n.select2Configuration&&(f=r.length===0&&n.isHiddenWhenEmpty(),i||r.unshift({displayName:"",value:""}),u=s(r,n.arrayOfSelectedValues),n.select2Configuration.data=u,f||(e=$('select[data-field-name="'+n.name()+'"]'),c(e,u)));n.options(r)}function v(n){var t=[];return $.each(n.dependentFieldNames(),function(n,i){var r=f(i);r&&$.each(r.arrayOfSelectedValues(),function(n,i){t.push({name:r.name(),value:i})})}),t}function y(n){n.xhr&&n.xhr.readyState!==4&&(n.xhr.abort(),n.xhr=null)}function p(n){var t=0;return $.each(u.customTicketFields,function(i,r){if(r.name()===n)return t=i,!1}),t}function w(n,t){if(n==null||n.length==0)return!1;if(t!=null&&n.some(function(n){return n.value.toLowerCase()===t.toString().toLowerCase()}))return t;var i=n.filter(function(n){return n.isDefault})[0];return i!=null?i.value:n[0].value}function e(n){typeof n=="string"&&(n=n.toLowerCase());switch(n){case"true":return!0;case"false":return!1;default:return n}}function h(n){return n==null?n:Object.prototype.toString.call(n)!=="[object Array]"?e(n):n.map(function(n){return e(n)}).filter(function(n){return n})}function b(){function o(t,i){t.loading=ko.observable(!1);t.disabled=ko.observable(!1);t.allDependeciesLoaded=ko.computed(function(){return!t.dependentFieldNames().some(function(n){var t=f(n);if(t)return t.loading()})});t.updateValues=function(){var r,u;t.loading(!0);r=function(){y(t);t.xhr=$.ajax({url:n.getExternalDatasourceValues,async:!0,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({propertyName:t.name(),propertyId:t.id(),parameters:v(t)}),success:i,complete:function(){t.loading(!1);t.updateInitialValue()}})};t.allDependeciesLoaded()?r():u=t.allDependeciesLoaded.subscribe(function(n){n&&(r(),u.dispose())})}}function b(n){o(n,function(t){t&&n.selectedValues(JSON.parse(t.Data))})}function k(n){c(n);n.increaseClick=function(){var t=parseInt(n.selectedValue())||0;n.selectedValue(t+1);$("[data-field-name="+n.name()+"]").trigger("change")};n.deductClick=function(){var t=parseInt(n.selectedValue())||0;t!==0&&(n.selectedValue(t-1),$("[data-field-name="+n.name()+"]").trigger("change"))}}function d(n){n.selectedValue=ko.observable(n.arrayOfSelectedValues()[0]);n.hasExternalDataSource()&&o(n,function(t){if(t){n.loading(!1);n.options(JSON.parse(t.Data));var i=h([w(n.options(),n.selectedValue())]);n.selectedValue(i&&i.length?i[0]:undefined)}});n.isVisible=function(){return!n.hasExternalDataSource()||n.options().length>0};n.isEnabled=function(){return!n.hasExternalDataSource()||n.options().length>1};n.optionDisplayValue=function(){var t=n.options().filter(function(t){return e(t.value)===n.selectedValue()})[0];return t?t.displayName:""}}function c(n){n.selectedValue=ko.observable();setTimeout(function(){n.selectedValue(n.arrayOfSelectedValues()[0]||"")},0)}function l(n,u){u||(n.selectedValue=ko.observable(n.arrayOfSelectedValues()[0]||""),n.options().unshift({displayName:"",value:""}));var f=s(ko.toJS(n.options),ko.toJS(n.arrayOfSelectedValues));n.select2Configuration={escapeMarkup:function(n){return typeof n=="string"?i.makeHtml(n,!0):n},allowClear:!0,language:t.cultureInfo,width:"100%",placeholder:u?t.selectMultiplePlaceholder:t.selectPlaceholder,minimumResultsForSearch:10,templateResult:function(n){if(!n.id)return n.text;if(n.css){var t=$("<span><\/span>");return t.addClass(n.css),t.text(n.text),t.attr("title",n.group&&n.root?n.group+" / "+n.text:n.text),t}return n.text},templateSelection:function(n){if(!n.id)return n.text;var t=$("<span><\/span>"),r=n.group&&n.root?"**"+n.group+"** / "+n.text:n.text;return t.attr("title",n.group&&n.root?n.group+" / "+n.text:n.text),t.append(i.makeHtml(r,!0)),t},data:f,matcher:r.customMatcher,sorter:r.customSorter,dataAdapter:r.updateArrayDataAdapter,closeOnSelect:!0,hideSelectedOptions:!0};n.hasExternalDataSource()&&o(n,function(t){t&&(n.loading(!1),a(n,JSON.parse(t.Data),u))})}function p(n){n.validation={isValid:ko.observable(!0),validationError:ko.observable("")};n.validation.validationError.subscribe(function(t){n.validation.isValid(t.length===0)})}$.each(u.ticketFields(),function(n,r){r.arrayOfSelectedValues=ko.observableArray();$.each(r.selectedValues(),function(n,t){r.arrayOfSelectedValues.push(t.value())});r.valueOnInit=ko.observableArray();r.isChanged=function(){return!i.helpers.arraysIdentical(r.valueOnInit(),r.arrayOfSelectedValues())};r.reset=function(){r.fieldTemplate()===0&&r.valueOnInit(h(r.valueOnInit()));r.arrayOfSelectedValues(r.valueOnInit()||[]);r.selectedValue&&r.selectedValue(r.valueOnInit()[0])};r.updateInitialValue=function(){r.valueOnInit(ko.unwrap(r.arrayOfSelectedValues()))};switch(r.fieldTemplate()){case 0:d(r);break;case 1:l(r);break;case 2:k(r);p(r);break;case 3:l(r,!0);break;case 4:c(r);break;case 7:b(r)}r.isRequiredForCustomers()&&p(r);r.onDOMReady=function(){var n;r.isRequiredForCustomers()&&(n=$("[data-field-name="+r.name()+"]"),n.attr("data-val-required",t.validation.required.replace("{0}",r.displayName())));r.fieldTemplate()===2&&(n=$("[data-field-name="+r.name()+"]"),n.attr("data-val-revision",t.validation.onlyDigits))};r.updateInitialValue();r.updateValues&&r.updateValues()})}function k(){function n(n){$.each(n.dependentFieldNames(),function(t,i){var r=f(i);r&&r.arrayOfSelectedValues.subscribe(function(){n.updateValues()})})}function r(n){n.loading.subscribe(function(t){n.disabled(t)})}$.each(u.ticketFields(),function(u,f){f.hasExternalDataSource()&&(n(f),r(f));f.selectedValue&&f.selectedValue.subscribe(function(n){var t=n?[n]:[];i.helpers.arraysIdentical(t,f.arrayOfSelectedValues())||f.arrayOfSelectedValues(t)});f.isRequiredForCustomers()&&$("#"+f.name()).attr("data-val-required",t.validation.required.replace("{0}",f.displayName()))})}var u={};return{init:function(n,t){u.ticketFields=t;u.customTicketFields=u.ticketFields().filter(function(n){return!n.isSystem()&&n.fieldTemplate()!==7});u.calculatedTicketFields=u.ticketFields().filter(function(n){return n.fieldTemplate()===7});n.getTicketField=f;n.getCustomFieldIndex=p;n.calculatedTicketFields=u.calculatedTicketFields;b();k()}}}(supportCenter.urlConfiguration,supportCenter.resources,supportCenter.common,select2.extentions)